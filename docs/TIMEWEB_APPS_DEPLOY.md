# Развертывание Supabase через Timeweb Apps (Docker Compose)

## Шаг 1: Пополнение баланса

1. В панели Timeweb перейдите в **"Баланс и платежи"**
2. Введите сумму: **минимум 500₽** (для тестирования)
3. Выберите способ оплаты: **"Российская банковская карта"**
4. Нажмите **"Оплатить картой"**
5. Дождитесь пополнения баланса

## Шаг 2: Подготовка репозитория

Убедитесь, что в вашем GitHub репозитории есть:
- ✅ `docker-compose.yml` (в корне проекта)
- ✅ `.env.docker` (или создайте файл `.env` в корне)

**Важно:** Если `.env.docker` в `.gitignore`, создайте файл `.env` специально для Timeweb.

## Шаг 3: Создание приложения в Timeweb Apps

1. **Перейдите в раздел "Apps":**
   - В левом меню найдите **"Apps"**
   - Нажмите на него

2. **Создайте новое приложение:**
   - Нажмите кнопку **"+ Создать приложение"** или **"Создать"**
   - Выберите тип: **"Docker Compose"**

3. **Подключите репозиторий:**
   - Выберите платформу: **GitHub**
   - Авторизуйтесь через GitHub (если нужно)
   - Выберите репозиторий: **`nazardubnak/HealApp-Web`**
   - Выберите ветку: **`master`** или **`main`**

4. **Настройте деплой:**
   - **Файл compose:** `docker-compose.yml` (должен определиться автоматически)
   - **Регион:** выберите ближайший (Москва/Санкт-Петербург)
   - **Конфигурация сервера:** минимум 2 ядра, 4 ГБ RAM

5. **Добавьте переменные окружения:**
   
   В разделе "Переменные окружения" добавьте все переменные из `.env.docker`:
   
   ```
   SUPABASE_DB_PASSWORD=ваш_пароль
   SUPABASE_JWT_SECRET=ваш_jwt_secret
   SUPABASE_ANON_KEY=ваш_anon_key
   SUPABASE_SERVICE_ROLE_KEY=ваш_service_role_key
   SUPABASE_SITE_URL=http://ваш_домен:54321
   SUPABASE_URI_ALLOW_LIST=http://ваш_домен:54321,http://localhost:54321
   SUPABASE_API_PORT=54321
   SUPABASE_API_SSL_PORT=54323
   SUPABASE_DB_PORT=54322
   SUPABASE_STUDIO_PORT=54324
   SUPABASE_FUNCTIONS_PORT=54325
   ```
   
   **Важно:** Замените `ваш_домен` на домен, который даст Timeweb, или используйте IP адрес.

6. **Запустите деплой:**
   - Нажмите **"Запустить деплой"** или **"Создать"**
   - Дождитесь завершения (может занять 5-10 минут)

## Шаг 4: Проверка работы

После успешного деплоя:

1. **Получите адрес приложения:**
   - В разделе Apps → ваше приложение
   - Там будет указан IP адрес или домен

2. **Проверьте доступность:**
   - Supabase Studio: `http://ваш_адрес:54324`
   - API Gateway: `http://ваш_адрес:54321`

3. **Проверьте логи:**
   - В разделе Apps → ваше приложение → **"Логи"**
   - Убедитесь, что все контейнеры запущены

## Шаг 5: Настройка портов (если нужно)

Если порты не открыты автоматически:

1. Перейдите в раздел **"Сети"** или **"Firewall"**
2. Откройте порты:
   - `54321` (API)
   - `54322` (PostgreSQL)
   - `54324` (Studio)
   - `54325` (Functions)

## Преимущества этого метода

✅ Автоматический деплой из GitHub  
✅ Не нужно настраивать SSH  
✅ Автоматическое обновление при push в репозиторий  
✅ Простое управление через веб-интерфейс  
✅ Автоматическое масштабирование  

## Если что-то не работает

1. **Проверьте логи в разделе Apps**
2. **Убедитесь, что все переменные окружения заполнены**
3. **Проверьте, что `docker-compose.yml` в корне репозитория**
4. **Убедитесь, что баланс достаточен для работы сервера**

