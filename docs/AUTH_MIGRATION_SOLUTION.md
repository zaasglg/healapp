# Решение проблемы с Auth миграцией

## Проблема

Миграция `20221208132122_backfill_email_last_sign_in_at` падает каждый раз при запуске Auth, даже если она помечена как выполненная.

Это происходит потому, что Auth проверяет файлы миграций в контейнере `/usr/local/etc/auth/migrations/`, а не только таблицу `auth.schema_migrations`.

## Решение

### Вариант 1: Исправить данные (уже выполнено)

Изменить `created_at` и `updated_at` в `auth.identities` так, чтобы условие миграции не находило записи.

### Вариант 2: Отключить проблемную миграцию в контейнере

Нужно либо:
- Удалить файл миграции из контейнера (требует пересборки образа)
- Исправить SQL в файле миграции (требует доступа к файловой системе контейнера)

### Вариант 3: Использовать другой образ Auth

Использовать более новую версию Auth, где эта миграция уже исправлена.

## Текущий статус

- ✅ Данные исправлены (UPDATE 0 - записей с '2022-11-25' нет)
- ✅ Миграция помечена как выполненная
- ⚠️ Auth все еще пытается выполнить миграцию из файла

## Рекомендация

Так как записей с `created_at = '2022-11-25'` нет, миграция не должна находить записи для обновления. Но Auth все еще пытается выполнить её и падает на условии `id = user_id::text`.

**Нужно исправить файл миграции в контейнере Auth** или использовать другой подход.

## Миграции из Supabase Cloud

Получен список всех миграций (95 миграций). Для применения нужно получить SQL через Supabase CLI.

